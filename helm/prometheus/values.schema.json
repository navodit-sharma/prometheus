{
  "definitions": {},
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://valamis.io/prometheus",
  "title": "Root",
  "type": "object",
  "required": [
    "global",
    "emissary-ingress",
    "prometheus-elasticsearch-exporter",
    "customResources",
    "kube-prometheus-stack"
  ],
  "oneOf": [
    {
      "properties": {
        "global": {
          "properties": {
            "platform": {
              "enum": ["azure"]
            }
          }
        },
        "emissary-ingress": {
          "properties": {
            "service": {
              "properties": {
                "type": {
                  "enum": ["LoadBalancer"]
                },
                "loadBalancerIP": {
                  "pattern": "[0-9]+.[0-9]+.[0-9]+.[0-9]+"
                }
              },
              "required": ["loadBalancerIP"]
            }
          }
        }
      }
    },
    {
      "properties": {
        "global": {
          "properties": {
            "platform": {
              "enum": ["azure"]
            }
          }
        },
        "emissary-ingress": {
          "properties": {
            "service": {
              "properties": {
                "type": {
                  "not": {
                    "enum": [
                      "LoadBalancer"
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "properties": {
        "global": {
          "properties": {
            "platform": {
              "not": {
                "enum": ["azure"]
              }
            }
          }
        },
        "emissary-ingress": {
          "properties": {
            "service": {
              "properties": {
                "type": {
                  "enum": ["LoadBalancer", "NodePort", "ClusterIP"]
                }
              }
            }
          }
        }
      }
    }
  ],
  "properties": {
    "global": {
      "$id": "#root/global",
      "title": "Global",
      "type": "object",
      "required": [
        "platform",
        "grafanaAdminPassword",
        "externalDomain"
      ],
      "properties": {
        "platform": {
          "$id": "#root/global/platform",
          "title": "Platform",
          "type": "string",
          "examples": [
            "azure",
            "onprem",
            "ubuntu",
            "minikube",
            "local"
          ],
          "pattern": "^.*$"
        },
        "emissary-ingress": {
          "$id": "#root/global/emissary-ingress",
          "title": "emissary-ingress",
          "type": "object",
          "required": [
            "enabled"
          ],
          "properties": {
            "enabled": {
              "$id": "#root/global/emissary-ingress/enabled",
              "title": "Enabled",
              "type": "boolean",
              "examples": [
                true,
                false
              ],
              "default": true
            }
          }
        },
        "kube-prometheus-stack": {
          "$id": "#root/global/kube-prometheus-stack",
          "title": "Kube-prometheus-stack",
          "type": "object",
          "required": [
            "enabled"
          ],
          "properties": {
            "enabled": {
              "$id": "#root/global/kube-prometheus-stack/enabled",
              "title": "Enabled",
              "type": "boolean",
              "examples": [
                true,
                false
              ],
              "default": true
            }
          }
        },
        "prometheus-elasticsearch-exporter": {
          "$id": "#root/global/prometheus-elasticsearch-exporter",
          "title": "Prometheus-elasticsearch-exporter",
          "type": "object",
          "required": [
            "enabled"
          ],
          "properties": {
            "enabled": {
              "$id": "#root/global/prometheus-elasticsearch-exporter/enabled",
              "title": "Enabled",
              "type": "boolean",
              "examples": [
                true,
                false
              ],
              "default": true
            }
          }
        },
        "grafanaAdminPassword": {
          "$id": "#root/global/grafanaAdminPassword",
          "title": "Grafanaadminpassword",
          "type": "string",
          "minLength": 12
        },
        "smtpApiKey": {
          "$id": "#root/global/smtpApiKey",
          "title": "Smtpapikey",
          "type": "string"
        },
        "externalDomain": {
          "$id": "#root/global/externalDomain",
          "title": "externalDomain",
          "type": "string",
          "pattern": "^[a-z0-9-]+.[a-z0-9-]+.[a-z0-9]+$"
        },
        "smtpDestinationAddress": {
          "$id": "#root/global/smtpDestinationAddress",
          "title": "Smtpdestinationaddress",
          "type": "string",
          "examples": [
            "abc@something.com",
            "xyz@whatever.com"
          ]
        },
        "web": {
          "$id": "#root/global/web",
          "title": "Web",
          "type": "object",
          "required": [
            "ssl"
          ],
          "properties": {
            "ssl": {
              "$id": "#root/global/web/ssl",
              "title": "Ssl",
              "type": "object",
              "required": [
                "enabled"
              ],
              "oneOf": [
                {
                  "properties": {
                    "letsencrypt": {
                      "properties": {
                        "enabled": {
                          "enum": [true]
                        }
                      }
                    }
                  }
                },
                {
                  "properties": {
                    "externalSecret": {
                      "properties": {
                        "enabled": {
                          "enum": [true]
                        }
                      }
                    }
                  }
                },
                {
                  "properties": {
                    "letsencrypt": {
                      "properties": {
                        "enabled": {
                          "enum": [false]
                        }
                      }
                    },
                    "externalSecret": {
                      "properties": {
                        "enabled": {
                          "enum": [false]
                        }
                      }
                    }
                  }
                }
              ],
              "properties": {
                "enabled": {
                  "$id": "#root/global/web/ssl/enabled",
                  "title": "Enabled",
                  "type": "boolean",
                  "examples": [
                    true,
                    false
                  ],
                  "default": true
                },
                "letsencrypt": {
                  "$id": "#root/global/web/ssl/letsencrypt",
                  "title": "Letsencrypt",
                  "type": "object",
                  "required": [
                    "enabled"
                  ],
                  "properties": {
                    "enabled": {
                      "$id": "#root/global/web/ssl/letsencrypt/enabled",
                      "title": "Enabled",
                      "type": "boolean",
                      "examples": [
                        false
                      ],
                      "default": true
                    }
                  }
                },
                "externalSecret": {
                  "$id": "#root/global/web/ssl/externalSecret",
                  "title": "Externalsecret",
                  "type": "object",
                  "required": [
                    "enabled"
                  ],
                  "if": {
                    "properties": {
                      "enabled": {
                        "enum": [true]
                      }
                    }
                  },
                  "then": {
                    "required": [
                      "backendType",
                      "keyVaultName"
                    ]
                  },
                  "properties": {
                    "enabled": {
                      "$id": "#root/global/web/ssl/externalSecret/enabled",
                      "title": "Enabled",
                      "type": "boolean",
                      "examples": [
                        true,
                        false
                      ],
                      "default": false
                    },
                    "esoMigrated": {
                      "$id": "#root/global/web/ssl/esoMigrated/enabled",
                      "title": "esoMigrated",
                      "type": "boolean",
                      "examples": [
                        true,
                        false
                      ],
                      "default": false
                    },
                    "backendType": {
                      "$id": "#root/global/web/ssl/externalSecret/backendType",
                      "title": "Backendtype",
                      "type": "string",
                      "examples": [
                        "azureKeyVault"
                      ],
                      "pattern": "^.*$"
                    },
                    "keyVaultName": {
                      "$id": "#root/global/web/ssl/externalSecret/keyVaultName",
                      "title": "Keyvaultname",
                      "type": "string",
                      "pattern": "^.*$"
                    },
                    "ClusterSecretStore": {
                      "$id": "#root/global/web/ssl/externalSecret/ClusterSecretStore",
                      "title": "ClusterSecretStore",
                      "type": "string",
                      "pattern": "^.*$"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "emissary-ingress": {
      "$id": "#root/emissary-ingress",
      "title": "emissary-ingress",
      "type": "object",
      "properties": {
        "crds": {
          "$id": "#root/emissary-ingress/crds",
          "title": "Crds",
          "type": "object",
          "properties": {
            "create": {
              "$id": "#root/emissary-ingress/crds/create",
              "title": "Create",
              "type": "boolean",
              "examples": [
                true,
                false
              ]
            },
            "enabled": {
              "$id": "#root/emissary-ingress/crds/enabled",
              "title": "Enabled",
              "type": "boolean",
              "examples": [
                true,
                false
              ]
            },
            "keep": {
              "$id": "#root/emissary-ingress/crds/keep",
              "title": "Keep",
              "type": "boolean",
              "examples": [
                true,
                false
              ]
            }
          }
        },
        "service": {
          "$id": "#root/emissary-ingress/service",
          "title": "Service",
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "$id": "#root/emissary-ingress/service/type",
              "title": "Type",
              "type": "string",
              "enum": [
                "LoadBalancer",
                "ClusterIP",
                "NodePort"
              ]
            },
            "loadBalancerIP": {
              "$id": "#root/emissary-ingress/service/loadBalancerIP",
              "title": "Loadbalancerip",
              "type": "string"
            },
            "externalTrafficPolicy": {
              "$id": "#root/emissary-ingress/service/externalTrafficPolicy",
              "title": "Externaltrafficpolicy",
              "type": "string",
              "enum": [
                "Local"
              ]
            }
          }
        }
      }
    },
    "prometheus-elasticsearch-exporter": {
      "$id": "#root/prometheus-elasticsearch-exporter",
      "title": "Prometheus-elasticsearch-exporter",
      "type": "object",
      "required": [
        "es"
      ],
      "properties": {
        "es": {
          "$id": "#root/prometheus-elasticsearch-exporter/es",
          "title": "Es",
          "type": "object",
          "required": [
            "uri"
          ],
          "properties": {
            "uri": {
              "$id": "#root/prometheus-elasticsearch-exporter/es/uri",
              "title": "Uri",
              "type": "string",
              "examples": [
                "http://aux-elasticsearch-master.shared.svc.cluster.local:9200"
              ],
              "pattern": "^http://.*:[0-9]+$"
            }
          }
        }
      }
    },
    "customResources": {
      "$id": "#root/customResources",
      "title": "Customresources",
      "type": "object",
      "required": [
        "prometheusCustomAlertRules",
        "grafanaCustomDashboard"
      ],
      "properties": {
        "prometheusCustomAlertRules": {
          "$id": "#root/customResources/prometheusCustomAlertRules",
          "title": "Prometheuscustomalertrules",
          "type": "object",
          "required": [
            "create"
          ],
          "properties": {
            "create": {
              "$id": "#root/customResources/prometheusCustomAlertRules/create",
              "title": "Create",
              "type": "boolean",
              "examples": [
                true,
                false
              ]
            }
          }
        },
        "grafanaCustomDashboard": {
          "$id": "#root/customResources/grafanaCustomDashboard",
          "title": "Grafanacustomdashboard",
          "type": "object",
          "required": [
            "create"
          ],
          "properties": {
            "create": {
              "$id": "#root/customResources/grafanaCustomDashboard/create",
              "title": "Create",
              "type": "boolean",
              "examples": [
                true,
                false
              ]
            }
          }
        }
      }
    },
    "kube-prometheus-stack": {
      "$id": "#root/kube-prometheus-stack",
      "title": "Kube-prometheus-stack",
      "type": "object",
      "required": [
        "nodeExporter",
        "alertmanager",
        "grafana",
        "prometheusOperator",
        "prometheus"
      ],
      "oneOf": [
        {
          "properties": {
            "prometheusOperator": {
              "properties": {
                "enabled": {
                  "enum": [true]
                }
              }
            },
            "prometheus": {
              "properties": {
                "enabled": {
                  "enum": [true]
                }
              }
            }
          }
        },
        {
          "properties": {
            "prometheusOperator": {
              "properties": {
                "enabled": {
                  "enum": [
                    false
                  ]
                }
              }
            },
            "prometheus": {
              "properties": {
                "enabled": {
                  "enum": [
                    false
                  ]
                }
              }
            }
          }
        }
      ],
      "properties": {
        "nodeExporter": {
          "$id": "#root/kube-prometheus-stack/nodeExporter",
          "title": "Nodeexporter",
          "type": "object",
          "required": [
            "enabled"
          ],
          "properties": {
            "enabled": {
              "$id": "#root/kube-prometheus-stack/nodeExporter/enabled",
              "title": "Enabled",
              "type": "boolean",
              "examples": [
                true,
                false
              ]
            }
          }
        },
        "alertmanager": {
          "$id": "#root/kube-prometheus-stack/alertmanager",
          "title": "Alertmanager",
          "type": "object",
          "required": [
            "enabled"
          ],
          "if": {
            "properties": {
              "enabled": {
                "enum": [true]
              }
            }
          },
          "then": {
            "properties": {
              "alertmanagerSpec": {
                "required": ["externalUrl"],
                "properties": {
                  "externalUrl": {
                    "pattern": "^http://[a-z0-9.-]+/alertmanager$",
                    "$comment": "Ex. http://{{ .Values.global.externalDomain }}/alertmanager"
                  }
                }
              }
            }
          },
          "properties": {
            "enabled": {
              "$id": "#root/kube-prometheus-stack/alertmanager/enabled",
              "title": "Enabled",
              "type": "boolean",
              "examples": [
                true,
                false
              ]
            },
            "alertmanagerSpec": {
              "$id": "#root/kube-prometheus-stack/alertmanager/alertmanagerSpec",
              "title": "Alertmanagerspec",
              "type": "object",
              "properties": {
                "externalUrl": {
                  "$id": "#root/kube-prometheus-stack/alertmanager/alertmanagerSpec/externalUrl",
                  "title": "Externalurl",
                  "type": "string"
                }
              }
            }
          }
        },
        "grafana": {
          "$id": "#root/kube-prometheus-stack/grafana",
          "title": "Grafana",
          "type": "object",
          "required": [
            "enabled"
          ],
          "properties": {
            "enabled": {
              "$id": "#root/kube-prometheus-stack/grafana/enabled",
              "title": "Enabled",
              "type": "boolean",
              "examples": [
                true,
                false
              ]
            },
            "adminUser": {
              "$id": "#root/kube-prometheus-stack/grafana/adminUser",
              "title": "Adminuser",
              "type": "string"
            },
            "adminPassword": {
              "$id": "#root/kube-prometheus-stack/grafana/adminPassword",
              "title": "Adminpassword",
              "type": "string"
            },
            "grafana.ini": {
              "$id": "#root/kube-prometheus-stack/grafana/grafana.ini",
              "title": "Grafana.ini",
              "type": "object"
            }
          }
        },
        "prometheusOperator": {
          "$id": "#root/kube-prometheus-stack/prometheusOperator",
          "title": "Prometheusoperator",
          "type": "object",
          "required": [
            "enabled"
          ],
          "properties": {
            "enabled": {
              "$id": "#root/kube-prometheus-stack/prometheusOperator/enabled",
              "title": "Enabled",
              "type": "boolean",
              "examples": [
                true,
                false
              ]
            }
          }
        },
        "prometheus": {
          "$id": "#root/kube-prometheus-stack/prometheus",
          "title": "Prometheus",
          "type": "object",
          "required": [
            "enabled"
          ],
          "if": {
            "properties": {
              "enabled": {
                "enum": [true]
              }
            }
          },
          "then": {
            "properties": {
              "prometheusSpec": {
                "required": [
                  "externalLabels",
                  "externalUrl"
                ]
              }
            }
          },
          "properties": {
            "enabled": {
              "$id": "#root/kube-prometheus-stack/prometheus/enabled",
              "title": "Enabled",
              "type": "boolean",
              "examples": [
                true,
                false
              ]
            },
            "prometheusSpec": {
              "$id": "#root/kube-prometheus-stack/prometheus/prometheusSpec",
              "title": "Prometheusspec",
              "type": "object",
              "properties": {
                "externalLabels": {
                  "$id": "#root/kube-prometheus-stack/prometheus/prometheusSpec/externalLabels",
                  "title": "Externallabels",
                  "type": "object"
                },
                "externalUrl": {
                  "$id": "#root/kube-prometheus-stack/prometheus/prometheusSpec/externalUrl",
                  "title": "Externalurl",
                  "type": "string",
                  "examples": [
                    "https://{{ .Values.global.externalDomain }}/prometheus"
                  ]
                }
              }
            },
            "additionalPodMonitors": {
              "$id": "#root/kube-prometheus-stack/prometheus/additionalPodMonitors",
              "title": "Additionalpodmonitors",
              "type": "array"
            },
            "additionalServiceMonitors": {
              "$id": "#root/kube-prometheus-stack/prometheus/additionalServiceMonitors",
              "title": "Additionalservicemonitors",
              "type": "array"
            }
          }
        }
      }
    }
  }
}
